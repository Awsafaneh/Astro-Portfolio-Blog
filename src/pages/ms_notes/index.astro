---
import BaseHead from "@astro/base/BaseHead.astro";
import Header from "@astro/header/Header.astro";
import Footer from "@astro/footer/Footer.astro";
import authorConfig from "@config/siteConfig/info.json";
import { getCollection } from "astro:content";
import SpeedInsights from "@vercel/speed-insights/astro";
import { featureFlags } from "@config/featureFlag/featureFlag.json";
export const prerender = false;
const publishedNotes = await getCollection(
  "ms_notes",
  ({ data }) => !data.lecture_draft
);
const subjects = [...new Set(publishedNotes.map((note) => note.data.subject))];

try {
  if (!featureFlags.showNotes) {
    return Astro.redirect("/access-denied");
  }
} catch (error) {
  return Astro.redirect("/404");
}
---

<html lang="en">
  <head>
    <BaseHead
      title={`MS Notes | ${authorConfig.SiteName}`}
      description={`Browse categorized notes on ${authorConfig.SiteName}`}
    />
  </head>
  <body class="text-white min-h-screen flex flex-col">
    <Header />
    <SpeedInsights />

    <main
      class="flex-grow px-4 sm:px-8 lg:px-20 pt-2 pb-10 flex flex-col items-start w-full"
    >
      <h1 class="text-4xl font-extrabold mb-6 w-full text-center">
        Welcome to MS Notes
      </h1>

      <div class="w-full max-w-2xl space-y-4">
        {
          subjects.map((subject, idx) => (
            <a
              href={`/ms_notes/${subject}`}
              class="group block bg-[--accent-dark] hover:bg-white/10 text-white px-6 py-4 rounded-lg relative overflow-hidden shadow-lg transition-all duration-300 border border-white/10 hover:pl-8"
              style={`z-index: ${100 - idx}`}
            >
              <div class="text-xl font-bold tracking-wide">{subject}</div>
              <div class="text-sm opacity-70 mt-1">
                Open notes in this subject
              </div>
              <span class="absolute left-0 top-0 h-full w-1 bg-white opacity-0 group-hover:opacity-100 transition-all duration-300" />
            </a>
          ))
        }
      </div>
    </main>

    <Footer />
  </body>
</html>
